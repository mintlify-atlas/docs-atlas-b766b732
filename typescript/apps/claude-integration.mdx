---
title: "Claude Desktop Integration"
description: "Use MCP widgets in Claude Desktop with the MCP Apps Extension"
---

# Claude Desktop Integration

Learn how to use mcp-use widgets in Claude Desktop using the MCP Apps Extension (SEP-1865).

## Overview

Claude Desktop supports MCP widgets through the **MCP Apps Extension**:

- Widgets are served as `text/html;profile=mcp-app` resources
- Metadata is passed via `_meta.ui` object
- Runtime API via postMessage bridge
- Auto-resize and container dimensions support

## Setup

### 1. Create MCP Server

Create a new mcp-use server:

```bash
npx create-mcp-use-app my-claude-server
cd my-claude-server
npm install
```

### 2. Create Widget

Create a widget in `resources/greeting/widget.tsx`:

```tsx resources/greeting/widget.tsx
import { McpUseProvider, useWidget } from 'mcp-use/react'
import { z } from 'zod'

const propSchema = z.object({
  name: z.string(),
  message: z.string()
})

export const widgetMetadata = {
  description: 'Display a personalized greeting',
  props: propSchema
}

type Props = z.infer<typeof propSchema>

const GreetingWidget = () => {
  const { props } = useWidget<Props>()

  return (
    <McpUseProvider>
      <div className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-3xl p-8">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Hello, {props.name}!
        </h1>
        <p className="text-lg text-gray-600 dark:text-gray-400">
          {props.message}
        </p>
      </div>
    </McpUseProvider>
  )
}

export default GreetingWidget
```

### 3. Use MCP Apps Type

mcp-use automatically generates `mcpApps` metadata. For custom configuration:

```typescript index.ts
server.uiResource({
  type: "mcpApps",  // Dual-protocol: works in ChatGPT AND Claude
  name: "greeting",
  htmlTemplate: `...`,
  metadata: {
    autoResize: true,  // Claude-specific: auto-resize to content
    prefersBorder: true,
    csp: {
      connectDomains: ["https://api.example.com"]
    }
  }
})
```

### 4. Run Server

```bash
npm run dev
```

Server runs at `http://localhost:3000`.

### 5. Add to Claude Desktop

Edit Claude's MCP configuration:

**macOS:** `~/Library/Application Support/Claude/mcp.json`

**Windows:** `%APPDATA%\Claude\mcp.json`

```json
{
  "mcpServers": {
    "my-server": {
      "url": "http://localhost:3000/mcp"
    }
  }
}
```

Restart Claude Desktop.

### 6. Test

In Claude, say: "Show me a greeting for Alice"

Your widget will render inline.

## MCP Apps Widget Type

Use `type: "mcpApps"` for widgets that work in both ChatGPT and Claude:

```typescript
server.uiResource({
  type: "mcpApps",
  name: "weather",
  htmlTemplate: `<!DOCTYPE html>...`,
  metadata: {
    // Universal metadata
    csp: {
      connectDomains: ["https://api.weather.com"],
      resourceDomains: ["https://cdn.weather.com"]
    },
    prefersBorder: true,

    // Claude-specific
    autoResize: true,  // Auto-resize to content height

    // ChatGPT-specific
    widgetDescription: "Weather widget with 5-day forecast"
  }
})
```

<Note>
  The `mcpApps` type generates metadata for **both** ChatGPT (Apps SDK) and Claude (MCP Apps). No need for separate configurations.
</Note>

## Claude-Specific Features

### Auto-Resize

Claude can automatically resize widgets to fit content:

```tsx
const MyWidget = () => {
  return (
    <McpUseProvider autoSize>
      <div>
        {/* Content of any height */}
        {/* Claude will auto-resize the iframe */}
      </div>
    </McpUseProvider>
  )
}
```

Or configure server-side:

```typescript
metadata: {
  autoResize: true
}
```

### Container Dimensions

Access widget container dimensions:

```tsx
const MyWidget = () => {
  const { maxHeight, maxWidth } = useWidget()

  return (
    <div style={{ maxHeight, maxWidth }}>
      Available space: {maxWidth}px × {maxHeight}px
    </div>
  )
}
```

### Device Capabilities

Detect device capabilities:

```tsx
const MyWidget = () => {
  const { userAgent } = useWidget()

  const isMobile = userAgent.device.type === 'mobile'
  const hasTouch = userAgent.capabilities.touch
  const hasHover = userAgent.capabilities.hover

  return (
    <div>
      {isMobile ? 'Mobile layout' : 'Desktop layout'}
      {hasTouch && <p>Touch gestures enabled</p>}
    </div>
  )
}
```

## Platform API

Claude provides MCP Apps protocol via postMessage. mcp-use abstracts this:

### Call Tools

```tsx
const MyWidget = () => {
  const { callTool } = useWidget()

  const handleRefresh = async () => {
    const result = await callTool('get-data', { id: 123 })
    console.log(result)
  }

  return <button onClick={handleRefresh}>Refresh</button>
}
```

### Send Messages

```tsx
const SearchWidget = () => {
  const { props, sendFollowUpMessage } = useWidget<SearchProps>()

  const handleLearnMore = (query: string) => {
    sendFollowUpMessage(`Tell me more about ${query}`)
  }

  return (
    <button onClick={() => handleLearnMore(props.query)}>
      Learn More
    </button>
  )
}
```

### Open Links

```tsx
const ProductWidget = () => {
  const { props, openExternal } = useWidget<ProductProps>()

  return (
    <button onClick={() => openExternal(props.productUrl)}>
      View Product
    </button>
  )
}
```

### Local State (No Persistence)

```tsx
const MyWidget = () => {
  const { state, setState } = useWidget<any, any, any, { count: number }>()

  const increment = async () => {
    await setState(prev => ({
      count: (prev?.count || 0) + 1
    }))
  }

  return (
    <div>
      <p>Count: {state?.count || 0}</p>
      <button onClick={increment}>Increment</button>
    </div>
  )
}
```

<Warning>
  State is **local only** in Claude Desktop. It does not persist across conversation turns. Use for temporary UI state only.
</Warning>

### Request Display Mode

```tsx
const ImageGallery = () => {
  const { displayMode, requestDisplayMode } = useWidget()

  const handleFullscreen = async () => {
    await requestDisplayMode('fullscreen')
  }

  return <button onClick={handleFullscreen}>View Fullscreen</button>
}
```

## Streaming Tool Arguments

Claude supports streaming tool arguments during LLM generation:

```tsx
const StreamingWidget = () => {
  const { isPending, isStreaming, partialToolInput, toolInput } = useWidget<{
    query: string
    filters: string[]
  }>()

  if (isPending) {
    if (isStreaming && partialToolInput) {
      // Show partial data as it streams
      return (
        <div>
          <p>Streaming...</p>
          <p>Query: {partialToolInput.query || 'waiting...'}</p>
          <p>Filters: {partialToolInput.filters?.join(', ') || 'waiting...'}</p>
        </div>
      )
    }
    return <div>Waiting for data...</div>
  }

  // Tool execution complete
  return (
    <div>
      <p>Query: {toolInput.query}</p>
      <p>Filters: {toolInput.filters.join(', ')}</p>
    </div>
  )
}
```

<Note>
  Streaming is a Claude-specific feature. ChatGPT sends complete arguments at once.
</Note>

## Complete Example

Here's a full weather widget optimized for Claude:

```tsx resources/weather/widget.tsx
import { McpUseProvider, useWidget } from 'mcp-use/react'
import { useState, useEffect } from 'react'
import { z } from 'zod'

const propSchema = z.object({
  city: z.string(),
  temperature: z.number(),
  conditions: z.string(),
  humidity: z.number().optional(),
  windSpeed: z.number().optional()
})

export const widgetMetadata = {
  description: 'Display current weather conditions',
  props: propSchema
}

type WeatherProps = z.infer<typeof propSchema>

const WeatherWidget = () => {
  const {
    props,
    isPending,
    isStreaming,
    partialToolInput,
    callTool,
    maxWidth,
    userAgent
  } = useWidget<WeatherProps>()

  const isMobile = userAgent.device.type === 'mobile'
  const [loading, setLoading] = useState(false)

  // Show streaming state
  if (isPending && isStreaming && partialToolInput) {
    return (
      <div className="p-6 rounded-xl bg-blue-50 dark:bg-blue-900/20">
        <div className="animate-pulse">
          <div className="h-8 bg-blue-200 dark:bg-blue-800 rounded w-1/2 mb-2" />
          <div className="h-4 bg-blue-200 dark:bg-blue-800 rounded w-1/3" />
        </div>
        <p className="text-sm text-gray-500 mt-4">
          Loading: {partialToolInput.city || '...'}
        </p>
      </div>
    )
  }

  if (isPending) {
    return (
      <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600" />
      </div>
    )
  }

  const handleRefresh = async () => {
    setLoading(true)
    try {
      await callTool('get-weather', { city: props.city })
    } finally {
      setLoading(false)
    }
  }

  return (
    <div
      className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-3xl"
      style={{
        padding: isMobile ? '1rem' : '2rem',
        maxWidth: maxWidth || '100%'
      }}
    >
      <div className="flex items-start justify-between mb-6">
        <div>
          <h2 className="text-3xl font-bold text-gray-900 dark:text-white">
            {props.city}
          </h2>
          <p className="text-gray-600 dark:text-gray-400 capitalize">
            {props.conditions}
          </p>
        </div>
        <div className="text-right">
          <div className="text-5xl font-bold text-blue-600 dark:text-blue-400">
            {props.temperature}°
          </div>
          <div className="text-sm text-gray-500">Celsius</div>
        </div>
      </div>

      {(props.humidity !== undefined || props.windSpeed !== undefined) && (
        <div className="grid grid-cols-2 gap-4 mb-6 pt-6 border-t border-blue-200 dark:border-blue-800">
          {props.humidity !== undefined && (
            <div>
              <div className="text-sm text-gray-500 mb-1">Humidity</div>
              <div className="text-xl font-semibold text-gray-900 dark:text-white">
                {props.humidity}%
              </div>
            </div>
          )}
          {props.windSpeed !== undefined && (
            <div>
              <div className="text-sm text-gray-500 mb-1">Wind Speed</div>
              <div className="text-xl font-semibold text-gray-900 dark:text-white">
                {props.windSpeed} km/h
              </div>
            </div>
          )}
        </div>
      )}

      <button
        onClick={handleRefresh}
        disabled={loading}
        className="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium rounded-lg transition-colors"
      >
        {loading ? 'Refreshing...' : 'Refresh'}
      </button>
    </div>
  )
}

const Widget = () => (
  <McpUseProvider autoSize>
    <WeatherWidget />
  </McpUseProvider>
)

export default Widget
```

Server configuration:

```typescript index.ts
import { MCPServer, widget } from 'mcp-use/server'
import { z } from 'zod'

const server = new MCPServer({
  name: 'weather-server',
  version: '1.0.0'
})

server.tool({
  name: 'get-weather',
  description: 'Get current weather for a city',
  schema: z.object({
    city: z.string()
  }),
  widget: {
    name: 'weather',
    invoking: 'Fetching weather data...',
    invoked: 'Weather data loaded'
  }
}, async ({ city }) => {
  const data = await fetchWeather(city)

  return widget({
    props: {
      city,
      temperature: data.temp,
      conditions: data.conditions,
      humidity: data.humidity,
      windSpeed: data.windSpeed
    },
    message: `Current weather in ${city}`
  })
})

await server.listen()
```

## Debugging

### Enable Debug Mode

```tsx
<McpUseProvider debugger>
  <MyWidget />
</McpUseProvider>
```

This shows:
- Widget props and tool input
- Platform API calls
- State changes
- MCP Apps bridge messages

### View Console Logs

1. Enable developer mode in Claude
2. Right-click widget → **Inspect**
3. View console output

### Test Locally

Use the mcp-use inspector:

```bash
mcp-use inspect
```

Navigate to `http://localhost:5173/inspector` and test your widgets.

## Platform Compatibility

| Feature | ChatGPT | Claude Desktop |
|---------|---------|----------------|
| Basic widgets | ✅ | ✅ |
| Dark mode | ✅ | ✅ |
| Tool calls | ✅ | ✅ |
| State (persistent) | ✅ | ❌ |
| State (local) | ✅ | ✅ |
| Follow-up messages | ✅ | ✅ |
| External links | ✅ | ✅ |
| Display modes | ✅ | ✅ |
| Auto-resize | ❌ | ✅ |
| Container dimensions | Partial | ✅ |
| Streaming args | ❌ | ✅ |
| Device capabilities | Partial | ✅ |

## Best Practices

### 1. Use mcpApps Type

For maximum compatibility:

```typescript
server.uiResource({
  type: "mcpApps",  // Works everywhere
  // ...
})
```

### 2. Handle Missing State Persistence

Don't rely on state persisting in Claude:

```tsx
// Bad: Assumes state persists
const { state } = useWidget()
if (!state.initialized) {
  // This runs every time in Claude
}

// Good: Handle missing state
const { state } = useWidget()
const favorites = state?.favorites || []
```

### 3. Use Auto-Resize

Let Claude handle sizing:

```tsx
<McpUseProvider autoSize>
  <MyWidget />
</McpUseProvider>
```

### 4. Show Streaming Progress

Take advantage of streaming:

```tsx
if (isStreaming && partialToolInput) {
  return <PartialView data={partialToolInput} />
}
```

### 5. Adapt to Device

```tsx
const { userAgent } = useWidget()
const isMobile = userAgent.device.type === 'mobile'

return (
  <div className={isMobile ? 'p-4' : 'p-8'}>
    {/* Responsive content */}
  </div>
)
```

## Troubleshooting

### Widget Not Loading

- Check Claude's `mcp.json` configuration
- Verify server is running: `curl http://localhost:3000/mcp`
- Restart Claude Desktop
- Check server logs

### State Not Working

Remember: State is **local only** in Claude. Use for temporary UI state:

```tsx
// OK: Local UI state
const [expanded, setExpanded] = useState(false)

// Don't expect this to persist:
const { state, setState } = useWidget()
await setState({ favorites: [...] })  // Lost on next turn
```

### Styling Issues

- Test in both light and dark modes
- Use Tailwind dark: classes
- Verify CSS is imported

## Next Steps

<CardGroup cols={2}>
  <Card title="ChatGPT Integration" icon="openai" href="/typescript/apps/chatgpt-integration">
    Deploy widgets to ChatGPT
  </Card>
  <Card title="React Hooks" icon="react" href="/typescript/apps/react-hooks">
    Learn about useWidget and other hooks
  </Card>
  <Card title="Server Widgets" icon="server" href="/typescript/server/widgets">
    Server-side widget configuration
  </Card>
</CardGroup>
